<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>æ–°é—»é¦–é¡µ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; }
        header { background:#222; color:#fff; padding:10px 20px; }
        header h1 { margin:0; font-size:24px; }

        /* è½®æ’­æ ·å¼ */
        #carousel { position:relative; width:100%; max-height:400px; overflow:hidden; margin-top:10px; }
        #carousel .slide { display:none; position:relative; }
        #carousel img { width:100%; height:400px; object-fit:cover; }
        #carousel .caption { position:absolute; bottom:10px; left:20px; color:#fff; background:rgba(0,0,0,0.5); padding:10px; border-radius:4px; }

        /* ç®­å¤´ */
        .prev, .next {
            cursor:pointer;
            position:absolute;
            top:50%;
            transform:translateY(-50%);
            color:white;
            font-weight:bold;
            font-size:24px;
            padding:10px;
            background:rgba(0,0,0,0.3);
            border-radius:50%;
        }
        .prev { left:10px; } .next { right:10px; }

        /* åœ†ç‚¹å¯¼èˆª */
        .dots { text-align:center; position:absolute; bottom:10px; width:100%; }
        .dot { cursor:pointer; height:12px; width:12px; margin:0 4px; background:#bbb; border-radius:50%; display:inline-block; transition:background 0.3s; }
        .dot.active { background:#717171; }

        /* åˆ†ç±»æ¨¡å— */
        .category-section { margin:20px; }
        .category-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
        .category-header h2 { margin:0; font-size:20px; }
        .category-header a { text-decoration:none; color:#007BFF; font-size:14px; }

        .category-news { display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap:15px; }
        .news-item { background:#fff; padding:10px; border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
        .news-item img { width:100%; height:150px; object-fit:cover; border-radius:4px; }
        .news-item h3 { font-size:16px; margin:8px 0 4px; }
        .news-item p { font-size:13px; color:#555; }

        footer { text-align:center; padding:20px; background:#222; color:#fff; margin-top:40px; }
        footer a { color:#fff; text-decoration:none; margin:0 4px; }
        footer a:hover { text-decoration:underline; }
    </style>
</head>
<body>
    <header>
        <h1>ğŸŒ æˆ‘çš„æ–°é—»ç½‘ç«™</h1>
    </header>

    <!-- è½®æ’­å›¾ -->
    <div id="carousel">
        <span class="prev" onclick="prevSlide()">&#10094;</span>
        <span class="next" onclick="nextSlide()">&#10095;</span>
        <div class="dots" id="carousel-dots"></div>
    </div>

    <!-- åˆ†ç±»æ¨¡å— -->
    <div id="categories-container"></div>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <footer>
      &copy; <span id="year"></span> æˆ‘çš„æ–°é—»èšåˆ | Powered by FastAPI <br>
      <a href="/about">å…³äºæˆ‘ä»¬</a> | 
      <a href="/contact">è”ç³»æ–¹å¼</a> | 
      <a href="/privacy">éšç§æ”¿ç­–</a> |
      <a href="/terms">æœåŠ¡æ¡æ¬¾</a> |
      <a href="/disclaimer">å…è´£å£°æ˜</a>
    </footer>

    <script>
        // ---------------- å½“å‰å¹´ä»½ ----------------
        document.getElementById('year').textContent = new Date().getFullYear();

        // ---------------- å…¨å±€å˜é‡ ----------------
        const categories = ["å›½å®¶","å›½é™…","å¨±ä¹","ä½“è‚²"];
        let carouselIndex = 0;
        let slides = [];

        // ---------------- è½®æ’­ ----------------
        async function loadCarousel() {
            const res = await fetch(`/api/news?category=all&limit=5`);
            const data = await res.json();
            slides = data.news;
            const carousel = document.getElementById("carousel");
            const dotsContainer = document.getElementById("carousel-dots");

            // æ¸…ç©ºå·²æœ‰å†…å®¹
            const oldSlides = carousel.querySelectorAll('.slide');
            oldSlides.forEach(s => s.remove());
            dotsContainer.innerHTML = "";

            slides.forEach((item, idx) => {
                const div = document.createElement("div");
                div.className = "slide";
                div.innerHTML = `
                    ${item.image_url ? `<img src="${item.image_url}" alt="">` : ""}
                    <div class="caption"><a href="/news/${item.id}" style="color:#fff; text-decoration:none;">${item.title}</a></div>
                `;
                carousel.insertBefore(div, dotsContainer);

                const dot = document.createElement("span");
                dot.className = "dot";
                dot.onclick = () => { carouselIndex = idx; showSlide(carouselIndex); };
                dotsContainer.appendChild(dot);
            });

            showSlide(carouselIndex);
            setInterval(() => { nextSlide(); }, 5000);
        }

        function showSlide(n) {
            const slideElems = document.getElementsByClassName("slide");
            const dots = document.getElementsByClassName("dot");
            for(let i=0;i<slideElems.length;i++){
                slideElems[i].style.display="none";
                dots[i].classList.remove("active");
            }
            if(slideElems[n]) slideElems[n].style.display="block";
            if(dots[n]) dots[n].classList.add("active");
        }

        function nextSlide() {
            carouselIndex = (carouselIndex + 1) % slides.length;
            showSlide(carouselIndex);
        }

        function prevSlide() {
            carouselIndex = (carouselIndex - 1 + slides.length) % slides.length;
            showSlide(carouselIndex);
        }

        // ---------------- åˆ†ç±»æ¨¡å— ----------------
        async function loadCategorySections() {
            const container = document.getElementById("categories-container");
            container.innerHTML = "";
            for(let cat of categories){
                const res = await fetch(`/api/news?category=${cat}&limit=5`);
                const data = await res.json();
                const section = document.createElement("div");
                section.className = "category-section";
                section.innerHTML = `
                    <div class="category-header">
                        <h2>${cat}</h2>
                        <a href="/category/${cat}">æŸ¥çœ‹æ›´å¤š</a>
                    </div>
                    <div class="category-news" id="news-${cat}"></div>
                `;
                container.appendChild(section);
                const newsDiv = section.querySelector(`#news-${cat}`);
                if(data.news.length === 0){
                    newsDiv.innerHTML = "<p>æš‚æ— æ–°é—»</p>";
                    continue;
                }
                data.news.forEach(item => {
                    newsDiv.innerHTML += `
                        <div class="news-item">
                            ${item.image_url ? `<img src="${item.image_url}" alt="">` : ""}
                            <h3><a href="/news/${item.id}">${item.title}</a></h3>
                            <p>${item.content.substring(0, 80)}...</p>
                        </div>
                    `;
                });
            }
        }

        // ---------------- é»˜è®¤åŠ è½½ ----------------
        loadCarousel();
        loadCategorySections();
    </script>
</body>
</html>
